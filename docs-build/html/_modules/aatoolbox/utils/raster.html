<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>aatoolbox.utils.raster &mdash; AA Toolbox  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->

        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
</head>

<body class="wy-body-for-nav">
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> AA Toolbox
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../config.html">Country Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../datasources.html">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../utilities.html">Utilities</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">AA Toolbox API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">AA Toolbox</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">aatoolbox.utils.raster</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">

  <h1>Source code for aatoolbox.utils.raster</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Utilities to manipulate and analyze raster data.</span>

<span class="sd">The raster module provides accessor utilities for xarray</span>
<span class="sd">data arrays and datasets accessible using the `aat` accessor.</span>
<span class="sd">These functions are available just by importing directly</span>
<span class="sd">the library using ``import aatoolbox``.</span>

<span class="sd">Since rioxarray already extends xarray, this</span>
<span class="sd">modules extensions inherit from the RasterArray and</span>
<span class="sd">RasterDataset extensions respectively. This ensures</span>
<span class="sd">cleaner code in the module as ``rio`` methods are</span>
<span class="sd">available immediately, but also means a couple of</span>
<span class="sd">design decisions are followed.</span>

<span class="sd">The ``xarray.DataArray`` and ``xarray.Dataset``</span>
<span class="sd">extensions here inherit from rioxarray base classes.</span>
<span class="sd">Thus, methods that are identical for both objects</span>
<span class="sd">are defined in a mixin class ``AatRasterMixin`` which</span>
<span class="sd">can be inherited by the two respective extensions.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">rioxarray</span>  <span class="c1"># noqa: F401</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">from</span> <span class="nn">rioxarray.exceptions</span> <span class="kn">import</span> <span class="n">DimensionError</span><span class="p">,</span> <span class="n">MissingCRS</span><span class="p">,</span> <span class="n">NoDataInBounds</span>
<span class="kn">from</span> <span class="nn">rioxarray.raster_array</span> <span class="kn">import</span> <span class="n">RasterArray</span>
<span class="kn">from</span> <span class="nn">rioxarray.raster_dataset</span> <span class="kn">import</span> <span class="n">RasterDataset</span>
<span class="kn">from</span> <span class="nn">rioxarray.rioxarray</span> <span class="kn">import</span> <span class="n">CRS</span><span class="p">,</span> <span class="n">_get_data_var_message</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="AatRasterMixin"><a class="viewcode-back" href="../../../aatoolbox.utils.html#aatoolbox.utils.raster.AatRasterMixin">[docs]</a><span class="k">class</span> <span class="nc">AatRasterMixin</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;AA toolbox mixin base class.&quot;&quot;&quot;</span>

    <span class="c1"># setting attributes to avoid mypy error, from SO</span>
    <span class="c1"># https://stackoverflow.com/questions/53120262/mypy-how-to-</span>
    <span class="c1"># ignore-missing-attribute-errors-in-mixins/53228204#53228204</span>
    <span class="n">x_dim</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">y_dim</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">_obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]</span>
    <span class="n">_height</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">_width</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">_crs</span><span class="p">:</span> <span class="n">CRS</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xarray_obj</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">xarray_obj</span><span class="p">)</span>

        <span class="c1"># Adding lat/lon to set of default spatial dims</span>
        <span class="k">if</span> <span class="s2">&quot;lat&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="o">.</span><span class="n">dims</span> <span class="ow">and</span> <span class="s2">&quot;lon&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_x_dim</span> <span class="o">=</span> <span class="s2">&quot;lon&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_dim</span> <span class="o">=</span> <span class="s2">&quot;lat&quot;</span>

        <span class="c1"># Adding Y/X to set of default spatial dims</span>
        <span class="k">if</span> <span class="s2">&quot;Y&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="o">.</span><span class="n">dims</span> <span class="ow">and</span> <span class="s2">&quot;X&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_x_dim</span> <span class="o">=</span> <span class="s2">&quot;X&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_dim</span> <span class="o">=</span> <span class="s2">&quot;Y&quot;</span>

        <span class="c1"># Managing time coordinate default dims</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t_dim</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_t_dim</span> <span class="o">=</span> <span class="n">t</span>

        <span class="c1"># longitude range indicates if coordinates are</span>
        <span class="c1"># between -180 and 180 or 0 and 360</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_longitude_range</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># methods derived from rioxarray.rioxarray.x_dim and y_dim</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">t_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;str: The dimension for time.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t_dim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DimensionError</span><span class="p">(</span>
                <span class="s2">&quot;Time dimension not found. &#39;aat.set_time_dim()&#39; or &quot;</span>
                <span class="s2">&quot;using &#39;rename()&#39; to change the dimension name to &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;t&#39; can address this.</span><span class="si">{</span><span class="n">_get_data_var_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t_dim</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">longitude_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;str: The longitude range.</span>

<span class="sd">        The longitude range indicates if coordinates are</span>
<span class="sd">        between -180 and 180 (indicated by &#39;180&#39;)</span>
<span class="sd">        or 0 and 360 (indicated by &#39;360&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_longitude_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_obj_aat</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">lon_max</span> <span class="o">=</span> <span class="n">data_obj</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_dim</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">lon_max</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_longitude_range</span> <span class="o">=</span> <span class="s2">&quot;360&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_longitude_range</span> <span class="o">=</span> <span class="s2">&quot;180&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DimensionError</span><span class="p">(</span>
                    <span class="s2">&quot;Longitude range not set due to missing &#39;x_dim&#39;.&quot;</span>
                    <span class="s2">&quot;Use &#39;aat.set_spatial_dims()&#39; to set the name of &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;the x dimension. </span><span class="si">{</span><span class="n">_get_data_var_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_longitude_range</span>

<div class="viewcode-block" id="AatRasterMixin.set_time_dim"><a class="viewcode-back" href="../../../aatoolbox.utils.html#aatoolbox.utils.raster.AatRasterMixin.set_time_dim">[docs]</a>    <span class="k">def</span> <span class="nf">set_time_dim</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">t_dim</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Set the time dimension of the dataset.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        t_dim: str</span>
<span class="sd">            The name of the time dimension.</span>
<span class="sd">        inplace: bool, optional</span>
<span class="sd">            If True, it will modify the dataarray in place.</span>
<span class="sd">            Otherwise it will return a modified copy.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Union[xarray.DataArray, xarray.Dataset]</span>
<span class="sd">            Data array or dataset with time dimension.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import xarray</span>
<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; da = xarray.DataArray(</span>
<span class="sd">        ...  numpy.arange(64).reshape(4,4,4),</span>
<span class="sd">        ...  coords={&quot;lat&quot;:numpy.array([87, 88, 89, 90]),</span>
<span class="sd">        ...          &quot;lon&quot;:numpy.array([5, 120, 199, 360]),</span>
<span class="sd">        ...          &quot;F&quot;:numpy.array([10,11,12,13])}</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; da.aat.set_time_dim(t_dim=&quot;F&quot;, inplace=True)</span>
<span class="sd">        &gt;&gt;&gt; da.aat.t_dim</span>
<span class="sd">        &#39;F&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_obj_aat</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="n">inplace</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t_dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data_obj</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DimensionError</span><span class="p">(</span>
                <span class="s2">&quot;Time dimension (</span><span class="si">{t_dim}</span><span class="s2">) not found.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_get_data_var_message</span><span class="p">(</span><span class="n">data_obj</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="n">data_obj</span><span class="o">.</span><span class="n">aat</span><span class="o">.</span><span class="n">_t_dim</span> <span class="o">=</span> <span class="n">t_dim</span>
        <span class="k">return</span> <span class="n">data_obj</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span> <span class="k">else</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="AatRasterMixin.correct_calendar"><a class="viewcode-back" href="../../../aatoolbox.utils.html#aatoolbox.utils.raster.AatRasterMixin.correct_calendar">[docs]</a>    <span class="k">def</span> <span class="nf">correct_calendar</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Correct calendar attribute for recognition by xarray.</span>

<span class="sd">        Some datasets come with a wrong calendar attribute that isn&#39;t</span>
<span class="sd">        recognized by xarray. This function corrects the coordinate</span>
<span class="sd">        attribute to ensure that a ``calendar`` attribute exists</span>
<span class="sd">        and specifies a calendar alias that is supportable by</span>
<span class="sd">        ``xarray.cftime_range`` and NetCDF in general.</span>

<span class="sd">        Currently ensures that calendar attributes that are either</span>
<span class="sd">        specified with ``units=&quot;months since&quot;`` or ``calendar=&quot;360&quot;``</span>
<span class="sd">        explicitly have ``calendar=&quot;360_day&quot;``. This is based on</span>
<span class="sd">        discussions in `this GitHub issue</span>
<span class="sd">        &lt;https://github.com/Unidata/netcdf4-python/issues/434&gt;`_.</span>
<span class="sd">        If and when further issues are found with calendar</span>
<span class="sd">        attributes, support for conversion will be added here.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        inplace: bool, optional</span>
<span class="sd">            If True, it will modify the dataarray in place.</span>
<span class="sd">            Otherwise it will return a modified copy.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Union[xarray.DataArray, xarray.Dataset]</span>
<span class="sd">            Data array or dataset with transformed calendar</span>
<span class="sd">            coordinate.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import xarray</span>
<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; da = xarray.DataArray(</span>
<span class="sd">        ...  numpy.arange(64).reshape(4,4,4),</span>
<span class="sd">        ...  coords={&quot;lat&quot;:numpy.array([87, 88, 89, 90]),</span>
<span class="sd">        ...          &quot;lon&quot;:numpy.array([5, 120, 199, 360]),</span>
<span class="sd">        ...          &quot;t&quot;:numpy.array([10,11,12,13])}</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; da[&quot;t&quot;].attrs[&quot;units&quot;] = &quot;months since 1960-01-01&quot;</span>
<span class="sd">        &gt;&gt;&gt; da_crct = da.aat.correct_calendar()</span>
<span class="sd">        &gt;&gt;&gt; da_crct[&quot;t&quot;].attrs[&quot;calendar&quot;]</span>
<span class="sd">        &#39;360_day&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_obj_aat</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="n">inplace</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;calendar&quot;</span> <span class="ow">in</span> <span class="n">data_obj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t_dim</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="ow">and</span> <span class="n">data_obj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t_dim</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;calendar&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;360&quot;</span>
        <span class="p">):</span>
            <span class="n">data_obj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t_dim</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;calendar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;360_day&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Calendar attribute changed from &#39;360&#39; to &#39;360_day&#39;.&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span>
            <span class="s2">&quot;units&quot;</span> <span class="ow">in</span> <span class="n">data_obj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t_dim</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="ow">and</span> <span class="s2">&quot;months since&quot;</span> <span class="ow">in</span> <span class="n">data_obj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t_dim</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="n">data_obj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t_dim</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;calendar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;360_day&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Calendar attribute &#39;360_day&#39; added, &quot;</span>
                <span class="s2">&quot;equivalent of &#39;units&#39; &#39;months since&#39;.&quot;</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No &#39;units&#39; or &#39;calendar&#39; attributes to correct.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_obj</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span> <span class="k">else</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="AatRasterMixin.invert_coordinates"><a class="viewcode-back" href="../../../aatoolbox.utils.html#aatoolbox.utils.raster.AatRasterMixin.invert_coordinates">[docs]</a>    <span class="k">def</span> <span class="nf">invert_coordinates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Invert latitude and longitude in data array.</span>

<span class="sd">        This function checks for inversion of latitude and longitude</span>
<span class="sd">        and inverts them if needed. Datasets with inverted coordinates</span>
<span class="sd">        can produce incorrect results in certain functions like</span>
<span class="sd">        ``rasterstats.zonal_stats()``. Correctly ordered coordinates</span>
<span class="sd">        should be:</span>

<span class="sd">        * latitude: Largest to smallest.</span>
<span class="sd">        * longitude: Smallest to largest.</span>

<span class="sd">        If data array already has correct coordinate ordering, it is</span>
<span class="sd">        directly returned. Function largely copied from</span>
<span class="sd">        https://github.com/perrygeo/python-rasterstats/issues/218.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        inplace : bool, optional</span>
<span class="sd">            If True, will overwrite existing data array. Default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Union[xarray.DataArray, xarray.Dataset]</span>
<span class="sd">            Data array or dataset with correct coordinate ordering.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import xarray</span>
<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; da = xarray.DataArray(</span>
<span class="sd">        ...  numpy.arange(16).reshape(4,4),</span>
<span class="sd">        ...  coords={&quot;lat&quot;:numpy.array([87, 88, 89, 90]),</span>
<span class="sd">        ...          &quot;lon&quot;:numpy.array([70, 69, 68, 67])}</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; da.aat.invert_coordinates(inplace=True)</span>
<span class="sd">        &gt;&gt;&gt; da.get_index(&quot;lon&quot;)</span>
<span class="sd">        Int64Index([67, 68, 69, 70], dtype=&#39;int64&#39;, name=&#39;lon&#39;)</span>
<span class="sd">        &gt;&gt;&gt; da.get_index(&quot;lat&quot;)</span>
<span class="sd">        Int64Index([90, 89, 88, 87], dtype=&#39;int64&#39;, name=&#39;lat&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_obj_aat</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="n">inplace</span><span class="p">)</span>
        <span class="n">lon_inv</span><span class="p">,</span> <span class="n">lat_inv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_coords_inverted</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">lon_inv</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Longitude was inverted, reversing coordinates.&quot;</span><span class="p">)</span>
            <span class="n">data_obj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_obj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_dim</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">lat_inv</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Latitude was inverted, reversing coordinates.&quot;</span><span class="p">)</span>
            <span class="n">data_obj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y_dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_obj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y_dim</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">data_obj</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span> <span class="k">else</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">_check_coords_inverted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if latitude and longitude inverted.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import xarray</span>
<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; da = xarray.DataArray(</span>
<span class="sd">        ...  numpy.arange(16).reshape(4,4),</span>
<span class="sd">        ...  coords={&quot;lat&quot;:numpy.array([90, 89, 88, 87]),</span>
<span class="sd">        ...          &quot;lon&quot;:numpy.array([70, 69, 68, 67])}</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; da.aat._check_coords_inverted()</span>
<span class="sd">        (True, False)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_obj_aat</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">data_obj</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_dim</span><span class="p">)</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">data_obj</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_dim</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lon</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">lon</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<div class="viewcode-block" id="AatRasterMixin.change_longitude_range"><a class="viewcode-back" href="../../../aatoolbox.utils.html#aatoolbox.utils.raster.AatRasterMixin.change_longitude_range">[docs]</a>    <span class="k">def</span> <span class="nf">change_longitude_range</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">to_180_range</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Convert longitude range between -180 to 180 and 0 to 360.</span>

<span class="sd">        The standard longitude range is from -180 to 180, while some</span>
<span class="sd">        applications use 0 to 360. This includes</span>
<span class="sd">        ```rasterstats.zonal_stats`` &lt;https://pypi.org/project/rasterstats/&gt;`_,</span>
<span class="sd">        which assumes ranges from 0 to 360.</span>

<span class="sd">        ``change_longitude_range()`` will convert between the</span>
<span class="sd">        two coordinate ranges based on its current state.</span>
<span class="sd">        By default it will use the -180 to 180 range unless</span>
<span class="sd">        `to_180_range` is False, then it will use 0-360</span>
<span class="sd">        If coordinates lie solely between 0 and 180 then there is</span>
<span class="sd">        no need for conversion and the input  will be returned.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        to_180_range : bool, default = True</span>
<span class="sd">            If True, the returned range is -180 to 180</span>
<span class="sd">            Else, the returned range is 0 to 360</span>
<span class="sd">        inplace : bool, optional</span>
<span class="sd">            If True, will overwrite existing data array. Default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Union[xarray.DataArray, xarray.Dataset]</span>
<span class="sd">            Dataset with transformed longitude coordinates.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import xarray</span>
<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; import pandas</span>
<span class="sd">        &gt;&gt;&gt; temp = 15 + 8 * numpy.random.randn(4, 4, 3)</span>
<span class="sd">        &gt;&gt;&gt; precip = 10 * numpy.random.rand(4, 4, 3)</span>
<span class="sd">        &gt;&gt;&gt; ds = xarray.Dataset(</span>
<span class="sd">        ...   {</span>
<span class="sd">        ...     &quot;temperature&quot;: ([&quot;lat&quot;, &quot;lon&quot;, &quot;time&quot;], temp),</span>
<span class="sd">        ...     &quot;precipitation&quot;: ([&quot;lat&quot;, &quot;lon&quot;, &quot;time&quot;], precip)</span>
<span class="sd">        ...   },</span>
<span class="sd">        ...   coords={</span>
<span class="sd">        ...     &quot;lat&quot;:numpy.array([87, 88, 89, 90]),</span>
<span class="sd">        ...     &quot;lon&quot;:numpy.array([5, 120, 199, 360]),</span>
<span class="sd">        ...     &quot;time&quot;: pandas.date_range(&quot;2014-09-06&quot;, periods=3)</span>
<span class="sd">        ...   }</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; ds_inv = ds.aat.change_longitude_range()</span>
<span class="sd">        &gt;&gt;&gt; ds_inv.get_index(&quot;lon&quot;)</span>
<span class="sd">        Int64Index([-161, 0, 5, 120], dtype=&#39;int64&#39;, name=&#39;lon&#39;)</span>
<span class="sd">        &gt;&gt;&gt; # invert coordinates back to original, in place</span>
<span class="sd">        &gt;&gt;&gt; ds_inv.aat.change_longitude_range(to_180_range=False, inplace=True)</span>
<span class="sd">        &gt;&gt;&gt; ds_inv.get_index(&quot;lon&quot;)</span>
<span class="sd">        Int64Index([0, 5, 120, 199], dtype=&#39;int64&#39;, name=&#39;lon&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_obj_aat</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="n">inplace</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">to_180_range</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">longitude_range</span> <span class="o">==</span> <span class="s2">&quot;360&quot;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Converting longitude from 0 360 to -180 to 180.&quot;</span><span class="p">)</span>

            <span class="n">data_obj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
                <span class="p">((</span><span class="n">data_obj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_dim</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span>
            <span class="p">)</span>
            <span class="n">data_obj</span><span class="o">.</span><span class="n">aat</span><span class="o">.</span><span class="n">_longitude_range</span> <span class="o">=</span> <span class="s2">&quot;180&quot;</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">to_180_range</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">longitude_range</span> <span class="o">==</span> <span class="s2">&quot;180&quot;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Converting longitude from -180 to 180 to 0 to 360.&quot;</span><span class="p">)</span>

            <span class="n">data_obj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">data_obj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_dim</span><span class="p">]</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>
            <span class="n">data_obj</span><span class="o">.</span><span class="n">aat</span><span class="o">.</span><span class="n">_longitude_range</span> <span class="o">=</span> <span class="s2">&quot;360&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Coordinates already in required range.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_obj</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span> <span class="k">else</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">_get_obj_aat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get object to modify.</span>

<span class="sd">        Originally directly used the ``rioxarray``</span>
<span class="sd">        _get_obj() method, however, this was silently failing</span>
<span class="sd">        so implementing a similar function directly within</span>
<span class="sd">        this module.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        inplace : bool</span>
<span class="sd">            If True, returns self</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Union[xr.DataArray, xr.Dataset]</span>
<span class="sd">            Object to modify.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj</span>

        <span class="n">obj_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># preserve attribute information</span>
        <span class="n">obj_copy</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">_x_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_dim</span>
        <span class="n">obj_copy</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">_y_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_dim</span>
        <span class="n">obj_copy</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_width</span>
        <span class="n">obj_copy</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_height</span>
        <span class="n">obj_copy</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crs</span>
        <span class="n">obj_copy</span><span class="o">.</span><span class="n">aat</span><span class="o">.</span><span class="n">_t_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t_dim</span>
        <span class="n">obj_copy</span><span class="o">.</span><span class="n">aat</span><span class="o">.</span><span class="n">_longitude_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_longitude_range</span>

        <span class="k">return</span> <span class="n">obj_copy</span></div>


<div class="viewcode-block" id="AatRasterArray"><a class="viewcode-back" href="../../../api.html#aatoolbox.utils.raster.AatRasterArray">[docs]</a><span class="nd">@xr</span><span class="o">.</span><span class="n">register_dataarray_accessor</span><span class="p">(</span><span class="s2">&quot;aat&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AatRasterArray</span><span class="p">(</span><span class="n">AatRasterMixin</span><span class="p">,</span> <span class="n">RasterArray</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;AA toolbox extension for xarray.DataArray.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xarray_object</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">xarray_object</span><span class="p">)</span>

<div class="viewcode-block" id="AatRasterArray.compute_raster_stats"><a class="viewcode-back" href="../../../api.html#aatoolbox.utils.raster.AatRasterArray.compute_raster_stats">[docs]</a>    <span class="k">def</span> <span class="nf">compute_raster_stats</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">gdf</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
        <span class="n">feature_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">stats_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">percentile_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">all_touched</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Compute raster statistics for polygon geometry.</span>

<span class="sd">        ``compute_raster_stats()`` is designed to</span>
<span class="sd">        quickly compute raster statistics across a polygon</span>
<span class="sd">        and its features.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gdf : geopandas.GeoDataFrame</span>
<span class="sd">            GeoDataFrame with row per area for stats computation.</span>
<span class="sd">            If ``pd.DataFrame`` is passed, geometry column must</span>
<span class="sd">            have the name ``geometry``.</span>
<span class="sd">        feature_col : str</span>
<span class="sd">            Column in ``gdf`` to use as row/feature identifier.</span>
<span class="sd">        stats_list : Optional[List[str]], optional</span>
<span class="sd">            List of statistics to calculate, by default None.</span>
<span class="sd">            Passed to ``get_attr()``.</span>
<span class="sd">        percentile_list : Optional[List[int]], optional</span>
<span class="sd">            List of percentiles to compute, by default None.</span>
<span class="sd">        all_touched : bool, optional</span>
<span class="sd">            If ``True`` all cells touching the region will be</span>
<span class="sd">            included, by default False. If ``False``, only</span>
<span class="sd">            cells with their centre in the region will be</span>
<span class="sd">            included.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas.DataFrame</span>
<span class="sd">            Dataframe with computed statistics.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import geopandas as gpd</span>
<span class="sd">        &gt;&gt;&gt; import xarray as xr</span>
<span class="sd">        &gt;&gt;&gt; import rioxarray</span>
<span class="sd">        &gt;&gt;&gt; from shapely.geometry import Polygon</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # compute raster stats on simple data</span>
<span class="sd">        &gt;&gt;&gt; d = {</span>
<span class="sd">        ...     &quot;name&quot;: [&quot;area_a&quot;, &quot;area_b&quot;],</span>
<span class="sd">        ...     &quot;geometry&quot;: [</span>
<span class="sd">        ...         Polygon([(0, 0), (0, 2), (2, 2), (2, 0)]),</span>
<span class="sd">        ...         Polygon([(2, 0), (2, 2), (3, 2), (3, 0)]),</span>
<span class="sd">        ...     ],</span>
<span class="sd">        ... }</span>
<span class="sd">        &gt;&gt;&gt; gdf = gpd.GeoDataFrame(d)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; da = xr.DataArray(</span>
<span class="sd">        ...     [[1, 2, 3], [4, 5, 6]],</span>
<span class="sd">        ...     dims=(&quot;y&quot;, &quot;x&quot;),</span>
<span class="sd">        ...     coords={&quot;y&quot;: [1.5, 0.5], &quot;x&quot;: [0.5, 1.5, 2.5]},</span>
<span class="sd">        ... ).rio.write_crs(&quot;EPSG:4326&quot;)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; da.aat.compute_raster_stats(</span>
<span class="sd">        ...     gdf=gdf,</span>
<span class="sd">        ...     feature_col=&quot;name&quot;</span>
<span class="sd">        ... ) # doctest: +SKIP</span>
<span class="sd">           mean_name            std_name min_name max_name sum_name count_name    name # noqa: E501</span>
<span class="sd">        0       3.0  1.5811388300841898        1        5     12.0          4  area_a  # noqa: E501</span>
<span class="sd">        1       4.5                 1.5        3        6      9.0          2  area_b  # noqa: E501</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MissingCRS</span><span class="p">(</span><span class="s2">&quot;No CRS found, set CRS before computation.&quot;</span><span class="p">)</span>

        <span class="n">data_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_obj_aat</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">df_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">stats_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stats_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">gdf</span><span class="p">[</span><span class="n">feature_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="n">gdf_adm</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">gdf</span><span class="p">[</span><span class="n">feature_col</span><span class="p">]</span> <span class="o">==</span> <span class="n">feature</span><span class="p">]</span>

            <span class="n">da_clip</span> <span class="o">=</span> <span class="n">data_obj</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">set_spatial_dims</span><span class="p">(</span>
                <span class="n">x_dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x_dim</span><span class="p">,</span> <span class="n">y_dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_dim</span>
            <span class="p">)</span>

            <span class="c1"># clip returns error if no overlapping raster cells for geometry</span>
            <span class="c1"># so catching and skipping rest of iteration so no stats computed</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">da_clip</span> <span class="o">=</span> <span class="n">da_clip</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
                    <span class="n">gdf_adm</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span> <span class="n">all_touched</span><span class="o">=</span><span class="n">all_touched</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="n">NoDataInBounds</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;No overlapping raster cells for </span><span class="si">%s</span><span class="s2">, skipping.&quot;</span><span class="p">,</span> <span class="n">feature</span>
                <span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">grid_stat_all</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">stats_list</span><span class="p">:</span>
                <span class="c1"># count automatically ignores NaNs</span>
                <span class="c1"># therefore skipna can also not be given as an argument</span>
                <span class="c1"># implemented count cause needed for computing percentages</span>
                <span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">stat</span> <span class="o">!=</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;skipna&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># makes sum return NaN instead of 0 if array</span>
                <span class="c1"># only contains NaNs</span>
                <span class="k">if</span> <span class="n">stat</span> <span class="o">==</span> <span class="s2">&quot;sum&quot;</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;min_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">grid_stat</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">da_clip</span><span class="p">,</span> <span class="n">stat</span><span class="p">)(</span>
                    <span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_dim</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">stat</span><span class="p">)</span>
                <span class="n">grid_stat_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grid_stat</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">percentile_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">grid_quant</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">da_clip</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">quant</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_dim</span><span class="p">])</span>
                    <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;quantile&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">quant</span><span class="si">}</span><span class="s2">quant&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">quant</span> <span class="ow">in</span> <span class="n">percentile_list</span>
                <span class="p">]</span>
                <span class="n">grid_stat_all</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">grid_quant</span><span class="p">)</span>

            <span class="c1"># if dims is 0, it throws an error when merging</span>
            <span class="c1"># and then converting to a df</span>
            <span class="c1"># this occurs when the input da is 2D</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">grid_stat_all</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
                <span class="n">df_adm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="n">da_stat</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="p">[</span><span class="n">da_stat</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">da_stat</span> <span class="ow">in</span> <span class="n">grid_stat_all</span>
                    <span class="p">}</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">zonal_stats_xr</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">grid_stat_all</span><span class="p">)</span>
                <span class="n">df_adm</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">zonal_stats_xr</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;spatial_ref&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="n">df_adm</span><span class="p">[</span><span class="n">feature_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span>
            <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_adm</span><span class="p">)</span>

        <span class="n">df_zonal_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df_zonal_stats</span></div></div>


<div class="viewcode-block" id="AatRasterDataset"><a class="viewcode-back" href="../../../api.html#aatoolbox.utils.raster.AatRasterDataset">[docs]</a><span class="nd">@xr</span><span class="o">.</span><span class="n">register_dataset_accessor</span><span class="p">(</span><span class="s2">&quot;aat&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AatRasterDataset</span><span class="p">(</span><span class="n">AatRasterMixin</span><span class="p">,</span> <span class="n">RasterDataset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;AA toolbox extension for xarray.Dataset.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xarray_object</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">xarray_object</span><span class="p">)</span>

<div class="viewcode-block" id="AatRasterDataset.get_raster_array"><a class="viewcode-back" href="../../../api.html#aatoolbox.utils.raster.AatRasterDataset.get_raster_array">[docs]</a>    <span class="k">def</span> <span class="nf">get_raster_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get xarray.DataArray from variable and keep dimensions.</span>

<span class="sd">        Accessing a component xarray.DataArray using the</span>
<span class="sd">        non-coordinate variable name loses and dimensions set</span>
<span class="sd">        through ``rio`` or ``aat``. This includes ``x_dim``,</span>
<span class="sd">        ``y_dim``, and ``t_dim`` that have to be specifically</span>
<span class="sd">        set using ``rio.set_spatial_dims()`` or</span>
<span class="sd">        ``aat.set_time_dim()`` respectively. For any dataset</span>
<span class="sd">        ``ds``, ``ds.get_raster_array(&quot;var&quot;)`` will retrieve</span>
<span class="sd">        the data array without losing the dimensions. Using</span>
<span class="sd">        ``ds[&quot;var&quot;]`` will lose the dimensions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        var_name : str</span>
<span class="sd">            Name of variable.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xarray.DataArray</span>
<span class="sd">            A data array.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import xarray</span>
<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; temp = 15 + 8 * numpy.random.randn(4, 4, 3)</span>
<span class="sd">        &gt;&gt;&gt; precip = 10 * np.random.rand(4, 4, 3)</span>
<span class="sd">        &gt;&gt;&gt; ds = xarray.Dataset(</span>
<span class="sd">        ...   {</span>
<span class="sd">        ...     &quot;temperature&quot;: ([&quot;lat&quot;, &quot;lon&quot;, &quot;F&quot;], temp),</span>
<span class="sd">        ...     &quot;precipitation&quot;: ([&quot;lat&quot;, &quot;lon&quot;, &quot;F&quot;], precip)</span>
<span class="sd">        ...   },</span>
<span class="sd">        ...   coords={</span>
<span class="sd">        ...     &quot;lat&quot;:numpy.array([87, 88, 89, 90]),</span>
<span class="sd">        ...     &quot;lon&quot;:numpy.array([5, 120, 199, 360]),</span>
<span class="sd">        ...     &quot;F&quot;: pd.date_range(&quot;2014-09-06&quot;, periods=3)</span>
<span class="sd">        ...   }</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; ds.aat.set_time_dim(&quot;F&quot;, inplace=True)</span>
<span class="sd">        &gt;&gt;&gt; da = ds.aat.get_raster_array(&quot;temperature&quot;)</span>
<span class="sd">        &gt;&gt;&gt; da.aat.t_dim</span>
<span class="sd">        &#39;F&#39;</span>
<span class="sd">        &gt;&gt;&gt; # directly accessing array loses set dimensions</span>
<span class="sd">        &gt;&gt;&gt; ds[&#39;temperature&#39;].aat.t_dim # doctest: +NORMALIZE_WHITESPACE</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">            ...</span>
<span class="sd">        rioxarray.exceptions.DimensionError: Time dimension not found.</span>
<span class="sd">            &#39;aat.set_time_dim()&#39; or using &#39;rename()&#39; to change the</span>
<span class="sd">            dimension name to &#39;t&#39; can address this.</span>
<span class="sd">        Data variable: temperature</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span>
        <span class="c1"># rioxarray attributes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">set_spatial_dims</span><span class="p">(</span>
                <span class="n">x_dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_dim</span><span class="p">,</span> <span class="n">y_dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_dim</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_crs</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># raster module attributes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">aat</span><span class="o">.</span><span class="n">set_time_dim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_t_dim</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">obj</span></div>

<div class="viewcode-block" id="AatRasterDataset.compute_raster_stats"><a class="viewcode-back" href="../../../api.html#aatoolbox.utils.raster.AatRasterDataset.compute_raster_stats">[docs]</a>    <span class="k">def</span> <span class="nf">compute_raster_stats</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">var_names</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute raster statistics across dataset arrays.</span>

<span class="sd">        ``compute_raster_stats()`` calculates raster statistics on</span>
<span class="sd">        component data arrays of a dataset. By default, calculates on all</span>
<span class="sd">        non-coordinate variables, unless a list of variable names is</span>
<span class="sd">        passed in, which then have statistics calculated for them.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        var_names : Union[List[str], str, None], optional</span>
<span class="sd">            Dataset data array variables to calculate raster statistics on.</span>

<span class="sd">        kwargs : Any</span>
<span class="sd">            Keyword arguments passed to the array method</span>
<span class="sd">            :meth:`~AatRasterArray.compute_raster_stats`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[pandas.DataFrame]</span>
<span class="sd">            List of raster statistics data frames.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import geopandas as gpd</span>
<span class="sd">        &gt;&gt;&gt; import xarray as xr</span>
<span class="sd">        &gt;&gt;&gt; import rioxarray</span>
<span class="sd">        &gt;&gt;&gt; from shapely.geometry import Polygon</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # compute raster stats on simple data</span>
<span class="sd">        &gt;&gt;&gt; d = {</span>
<span class="sd">        ...     &quot;name&quot;: [&quot;area_a&quot;, &quot;area_b&quot;],</span>
<span class="sd">        ...     &quot;geometry&quot;: [</span>
<span class="sd">        ...         Polygon([(0, 0), (0, 2), (2, 2), (2, 0)]),</span>
<span class="sd">        ...         Polygon([(2, 0), (2, 2), (3, 2), (3, 0)]),</span>
<span class="sd">        ...     ],</span>
<span class="sd">        ... }</span>
<span class="sd">        &gt;&gt;&gt; gdf = gpd.GeoDataFrame(d)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; ds = xr.DataArray(</span>
<span class="sd">        ...     [[1, 2, 3], [4, 5, 6]],</span>
<span class="sd">        ...     dims=(&quot;y&quot;, &quot;x&quot;),</span>
<span class="sd">        ...     coords={&quot;y&quot;: [1.5, 0.5], &quot;x&quot;: [0.5, 1.5, 2.5]},</span>
<span class="sd">        ... ).rio.write_crs(&quot;EPSG:4326&quot;).to_dataset(name=&quot;data&quot;)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; ds.aat.compute_raster_stats(</span>
<span class="sd">        ...    var_names=[&quot;data&quot;],</span>
<span class="sd">        ...    gdf=gdf,</span>
<span class="sd">        ...    feature_col=&quot;name&quot;</span>
<span class="sd">        ... ) # doctest: +SKIP</span>
<span class="sd">        [       mean                 std      min      max      sum      count    name # noqa: E501</span>
<span class="sd">        0       3.0  1.5811388300841898        1        5     12.0          4  area_a  # noqa: E501</span>
<span class="sd">        1       4.5                 1.5        3        6      9.0          2  area_b] # noqa: E501</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">var_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">var_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">var_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">var_names</span><span class="p">]</span>

        <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">aat</span><span class="o">.</span><span class="n">compute_raster_stats</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">var_names</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">stats</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Centre for Humanitarian Data Predictive Analytics Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

</body>
</html>
